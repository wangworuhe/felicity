# 2026-02-21 开发日志

## [语音功能] Bug 修复

**修改文件**：
- `miniprogram/pages/home/index.js`
- `miniprogram/pages/home/index.wxml`
- `miniprogram/pages/home/index.wxss`
- `miniprogram/components/editModal/index.js`
- `miniprogram/components/editModal/index.wxml`
- `miniprogram/components/editModal/index.wxss`

**改动说明**：

### Bug 1: 录音交互改为点击模式
- 将录音按钮从 `bindtouchstart`/`bindtouchend`（长按模式）改为 `bindtap`（点击切换模式）
- 合并 `onVoiceStart`/`onVoiceEnd`/`onVoiceCancel` 为 `onVoiceToggle`
- 解决异步竞态：`wx.getSetting` 回调中启动录音，`touchend` 可能在回调前触发导致状态异常
- 首页和 editModal 同步修改

### Bug 2: 添加语音播放功能
- 使用 `innerAudioContext` 实现语音播放，通过 `wx.cloud.getTempFileURL` 获取临时 URL
- 草稿卡片语音条添加播放/暂停按钮（▶/⏸）
- 历史记录卡片新增语音列表展示和播放
- editModal 语音列表添加播放功能
- 页面卸载/弹窗关闭时销毁 audioContext

### Bug 3: 历史记录多图展示
- `loadRecords` 中保留 `image_urls` 数组（原来只取 `image_url` 单张）
- WXML 用 `wx:for` 遍历 `image_urls` 数组展示多图

**影响范围**：
- 首页录音交互、语音播放、历史记录展示
- editModal 录音交互、语音播放
